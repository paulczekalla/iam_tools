import json
import copy
from lib.auth import Auth, AuthException
from lib.httpHandler import HttpHandler
from lib.fileWriter import FileWriter

def aquireAuthToken(authObj, http):
    token = ""
    try:
        token = authObj.readResponse(authObj.authorizationRequest(http))
    except AuthException as e:
        print("Login mit Zugang {} nicht m√∂glich.".format(e.login))
        print("Zugangsdaten erneut eingeben: ")
        login = input("Login: ")
        password = input("Passwort: ")
        aquireAuthToken(Auth(login, password), http)
    else:
        http.setToken(token)

proxies = {
  "http": "http://proxy.t-online.net:3128",
  "https": "http://proxy.t-online.net:3128",
}

http = HttpHandler(proxies, "http://api.appnexus.com")

a = Auth("a", "b")

aquireAuthToken(a, http)

placements = (1703314,1703315,1703316,1703317,1703318,1703320,1703322,1703325,1703326,1703327,1703328,1703329,1703330,1703332,1703333,1703337,1703338,1703339,1703340,1703341,1703342,1703343,1703344,1703345,1703346,1703347,1703348,1703349,1703350,1703351,1703352,1703353,1703354,1703356,1703359,1703361,1703362,1703363,1703364,1703365,1703366,1703367,1703368,1703369,1703370,1703371,1703372,1703373,1703374,1703375,1703376,1703377,1703378,1703379,1703380,1703381,1703382,1703383,1703384,1703385,1703387,1703388,1703389,1703390,1703391,1703392,1703393,1703395,1703396,1703397,1703398,1703399,1703400,1703402,1703403,1703404,1703405,1703406,1703407,1703408,1703409,1703410,1703412,1703413,1703414,1703415,1703416,1703417,1703419,1703420,1703421,1703422,1703423,1703425,1703426,1703427,1703428,1703429,1703431,1703432,1703433,1703434,1703435,1703436,1703437,1703438,1703440,1703441,1703442,1703443,1703444,1703445,1703446,1703447,1703448,1703449,1703450,1703451,1703452,1703453,1703454,1703455,1703456,1703457,1703458,1703459,1703460,1703461,1703462,1703463,1703464,1703465,1703466,1703467,1703468,1703469,1703470,1703471,1703472,1703473,1703474,1703475,1703476,1703477,1703478,1703479,1703480,1703481,1703482,1703483,1703484,1703485,1703486,1703487,1703488,1703489,1703490,1703491,1703492,1703493,1703494,1703495,1703496,1703497,1703498,1703499,1703501,1703502,1703503,1703505,1703506,1703507,1703509,1703510,1703511,1703512,1703514,1703515,1703516,1703517,1703518,1703519,1703520,1703521,1703522,1703523,1703524,1703525,1703526,1703527,1703528,1703529,1703530,1703531,1703532,1703533,1703534,1703535,1703536,1703537,1703538,1703539,1703540,1703541,1703542,1703543,1703544,1703545,1703546,1703547,1703548,1703549,1703550,1703551,1703552,1703553,1703554,1703555,1703556,1703557,1703558,1703559,1703560,1703561,1703562,1703563,1703564,1703565,1703566,1703567,1703568,1703569,1703570,1703571,1703572,1703573,1703574,1703575,1703576,1703577,1703578,1703579,1703580,1703581,1703582,1703583,1703584,1703585,1703586,1703587,1703588,1703589,1703590,1703591,1703593,1703594,1703595,1703596,1703597,1703598,1703599,1703600,1703601,1703602,1703604,1703605,1703606,1703607,1703608,1703609,1703610,1703611,1703612,1703613,1703614,1703615,1703616,1703617,1703618,1703619,1703620,1703621,1703622,1703623,1703624,1703625,1703626,1703627,1703628,1703629,1703630,1703631,1703632,1703633,1703634,1703635,1703636,1703637,1703638,1703639,1703640,1703641,1703642,1703643,1703644,1703645,1703646,1703647,1703648,1703649,1703650,1703651,1703652,1703653,1703654,1703655,1703656,1703657,1703658,1703659,1703660,1703661,1703662,1703663,1703664,1703665,1703666,1703667,1703668,1703669,1703670,1703671,1703672,1703673,1703674,1703677,1703678,1703679,1703680,1703681,1703682,1703683,1703684,1703685,1703686,1703687,1703688,1703690,1703691,1703692,1703694,1703695,1703696,1703697,1703698,1703699,1703700,1703701,1703702,1703703,1703704,1703705,1703707,1703708,1703709,1703711,1703715,1703716,1703717,1703718,1703719,1703720,1703721,1703722,1703723,1703724,1703725,1703726,1703727,1703728,1703729,1703730,1703731,1703732,1703733,1703735,1703736,1703737,1703738,1703739,1703740,1703741,1703742,1703743,1703745,1703746,1703747,1703748,1703749,1703750,1703751,1703752,1703753,1703755,1703756,1703757,1703758,1703759,1703760,1703762,1703763,1703764,1703765,1703766,1703767,1703768,1703770,1703771,1703772,1703773,1703774,1703775,1703776,1703777,1703778,1703779,1703780,1703781,1703782,1703783,1703784,1703786,1703787,1703788,1703789,1703790,1703791,1703792,1703793,1703794,1703795,1703796,1703797,1703798,1703799,1703800,1703801,1703802,1703803,1703804,1703805,1703806,1703807,1703808,1703809,1703810,1703811,1703812,1703813,1703814,1703815,1703816,1703817,1703818,1703819,1703820,1703821,1703822,1703823,1703824,1703825,1703826,1703827,1703828,1703829,1703830,1703831,1703832,1703833,1703834,1703835,1703836,1703837,1703838,1703839,1703840,1703841,1703842,1703843,1703844,1703845,1703846,1703847,1703848,1703849,1703850,1703852,1703853,1703855,1703856,1703858,1703859,1703860,1703861,1703863,1703864,1703865,1703866,1703867,1703868,1703869,1703870,1703871,1703872,1703873,1703874,1703875,1703876,1703877,1703878,1703879,1703880,1703881,1703882,1703883,1703884,1703885,1703886,1703887,1703888,1703889,1703890,1703891,1703892,1703894,1703897,1703900,1703901,1703902,1703903,1703904,1703905,1703906,1703907,1703908,1703909,1703910,1703911,1703912,1703913,1706717,1723567,1723569,1792030,1852182,1961724,2030134,2063618,2063675,2063751,2063752,2063753,2063754,2063755,2063756,2063757,2063758,2063759,2063760,2063761,2063763,2063764,2063766,2063767,2063768,2063771,2063772,2063773,2063774,2063775,2063776,2063777,2063778,2063779,2063780,2063781,2063782,2063783,2063784,2063785,2063786,2063788,2063789,2063790,2063791,2063793,2063794,2063795,2063796,2063797,2063798,2063799,2063800,2063801,2063802,2063804,2063806,2063809,2063812,2063814,2063815,2063816,2063817,2063818,2063819,2063820,2063821,2063822,2063823,2063824,2063825,2063826,2063827,2063828,2063829,2063830,2063831,2063832,2063833,2063834,2063836,2063837,2063838,2063839,2063840,2063841,2063842,2063843,2063844,2063845,2063846,2063847,2063848,2063849,2063850,2063851,2063852,2063853,2063855,2063856,2063857,2063858,2063859,2063860,2063861,2063862,2063863,2063864,2063865,2063866,2063867,2063868,2063869,2063870,2063871,2063872,2063873,2063874,2063875,2063876,2063877,2063878,2063879,2063880,2063881,2063882,2063883,2063884,2063885,2063886,2063887,2063888,2063889,2063890,2069986,2073796,2073809,2073816,2074303,2074304,2074305,2074306,2074307,2091167,2106939,2106940,2106941,2106942,2106943,2106944,2106945,2106946,2106947,2106948,2106949,2106950,2106951,2106955,2106956,2106957,2106958,2106959,2106960,2106961,2106962,2106963,2106964,2106965,2106966,2106967,2106968,2106969,2106970,2106971,2106972,2106975,2106976)

filename = "log_updated_placements.csv"

writer_content = list()
writer_content.append('Id;Name;Status;is_resizable\n')

number = 1
for placement_id in placements:
    print('Fortschritt: ' + str(number) + ' / ' + str(len(placements)))
    params = {'id':str(placement_id)}
    
    payload = {"placement":{"is_resizable":True}}
    resp = http.putRequest(payload, "placement", params).json()['response']
    writer_string = str(placement_id) + '; ' + resp['placement']['name'] + '; ' + resp['status'] + ';' + str(resp['placement']['is_resizable']) + '\n'
    writer_content.append(writer_string)
    number+=1

fw = FileWriter(filename, 'w')

for line in writer_content:
    fw.writeInNewFile(line)

fw.closeFile()
